# Parameter Example Override - OpenAPI 3.1.0

## Feature Overview

The confytome processor fully supports **OpenAPI 3.1.0 parameter example overrides**, where operation-level parameters can override path-level parameters, including their examples.

## Implementation

### Code Location
**File:** `/packages/core/utils/OpenApiProcessor.js`
**Method:** `mergeParameters()` (lines 1207-1231)

### How It Works

1. **Path-level parameters** are defined at the path item level and apply to ALL operations on that path
2. **Operation-level parameters** are defined per HTTP method (GET, POST, etc.)
3. **Override behavior**: If an operation parameter has the same `name` and `in` (location) as a path parameter, it **completely replaces** the path parameter for that operation

### Key Implementation Details

```javascript
mergeParameters(pathLevelParams = [], operationLevelParams = [], spec) {
  // Resolve all $refs in both parameter arrays
  const resolvedPathParams = this.resolveParameters(pathLevelParams, spec);
  const resolvedOpParams = this.resolveParameters(operationLevelParams, spec);

  // Start with path-level parameters
  const merged = [...resolvedPathParams];

  // Create a lookup map: "name:location" -> parameter
  const pathParamKeys = new Set(
    resolvedPathParams.map(p => `${p.name}:${p.in}`.toLowerCase())
  );

  // Process operation-level parameters
  for (const param of resolvedOpParams) {
    const key = `${param.name}:${param.in}`.toLowerCase();

    if (pathParamKeys.has(key)) {
      // OVERRIDE: Replace the path-level parameter
      const index = merged.findIndex(
        p => `${p.name}:${p.in}`.toLowerCase() === key
      );
      if (index !== -1) {
        merged[index] = param;  // Complete replacement
      }
    } else {
      // ADD: New parameter unique to this operation
      merged.push(param);
    }
  }

  return merged;
}
```

## Example Usage

### OpenAPI Spec

```yaml
openapi: 3.1.0
paths:
  /search:
    parameters:
      - name: query
        in: query
        schema:
          type: string
        examples:
          default:
            summary: Default search
            value: "general search"
          advanced:
            summary: Advanced search
            value: "field:value AND field2:value2"

    get:
      summary: Basic search
      # Uses path-level parameter examples

    post:
      summary: Advanced search with custom examples
      parameters:
        - name: query
          in: query
          schema:
            type: string
          examples:
            complex:
              summary: Complex query
              value: "(field1:value1 OR field2:value2) AND field3:value3"
            simple:
              summary: Simple query
              value: "overridden simple query"
      # Operation parameter OVERRIDES path parameter completely
```

### Result

- **GET /search**: Uses path-level `query` parameter with examples:
  - `default`: "general search"
  - `advanced`: "field:value AND field2:value2"

- **POST /search**: Uses operation-level `query` parameter with examples:
  - `complex`: "(field1:value1 OR field2:value2) AND field3:value3"
  - `simple`: "overridden simple query"

## Test Coverage

### Test File
**Location:** `/packages/core/test/parameter-examples.test.js`
**Test:** "should override parameter examples at operation level (OpenAPI 3.1.0)"

### What the Test Validates

1. ✅ Path-level parameters are used by default
2. ✅ Operation-level parameters completely replace path-level ones
3. ✅ Examples are overridden along with the parameter
4. ✅ Multiple operations on the same path can have different examples
5. ✅ Parameter matching is based on both `name` AND `in` location

## OpenAPI 3.1.0 Compliance

This implementation follows the [OpenAPI 3.1.0 specification](https://spec.openapis.org/oas/v3.1.0#fixed-fields-7) which states:

> "A list of parameters that are applicable for all the operations described under this path. These parameters can be overridden at the operation level, but cannot be removed there."

**Key Points:**
- ✅ Path parameters apply to all operations by default
- ✅ Operation parameters override path parameters (by name + location)
- ✅ Complete replacement, not merging
- ✅ Examples are part of the parameter, so they're overridden too

## Use Cases

### 1. Different Search Complexity Levels
```yaml
paths:
  /search:
    parameters:
      - name: query
        examples:
          simple: { value: "basic search" }
    get:
      # Uses simple example
    post:
      parameters:
        - name: query
          examples:
            complex: { value: "advanced (query)" }
      # Uses complex example
```

### 2. Development vs Production Examples
```yaml
paths:
  /users/{userId}:
    parameters:
      - name: userId
        examples:
          production: { value: "550e8400-e29b-41d4-a716-446655440000" }
    get:
      # Uses production example
    delete:
      parameters:
        - name: userId
          examples:
            test: { value: "test-user-id-123" }
      # Uses test example for dangerous operations
```

### 3. Context-Specific Parameter Descriptions
```yaml
paths:
  /documents/{docId}:
    parameters:
      - name: docId
        description: Document identifier
        examples:
          generic: { value: "doc-123" }
    get:
      # Generic description
    patch:
      parameters:
        - name: docId
          description: Document identifier (must be owned by requesting user)
          examples:
            owned: { value: "user-doc-456" }
      # More specific description for modification operation
```

## Benefits

1. **Flexibility**: Same endpoint can show different examples per operation
2. **Context**: Examples can match the operation's purpose (read vs write)
3. **Documentation**: More precise API documentation per HTTP method
4. **Developer Experience**: Better examples in Swagger UI and generated docs
5. **Spec Compliance**: Follows OpenAPI 3.1.0 standard behavior

## Related Features

- **Parameter $ref resolution** (lines 1234-1260)
- **Parameter groups** (custom extension for shared parameter sets)
- **Example extraction** (`extractParameterExamples()` method)
- **Component references** (parameters defined in `#/components/parameters`)

## Test Results

```
✓ should override parameter examples at operation level (OpenAPI 3.1.0) (3 ms)
```

**Total parameter example tests:** 11 tests, all passing
**Total core tests:** 153 tests, all passing

## Version

- **Confytome Core:** v1.9.12
- **OpenAPI Support:** 3.1.0
- **Feature Status:** ✅ Fully implemented and tested
- **Last Updated:** October 2, 2025
